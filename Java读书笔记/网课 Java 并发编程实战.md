网课 Java 并发编程实战.md

# 可见性、原子性、有序性

一个线程对共享变量的修改，另一个线程能够立刻看到，我们称为可见性。

我们把一个或者多个操作在CPU执行的过程中不被中断的特性称为原子性。

有序性指的是程序按照代码的先后顺序执行。

## Java内存模型: 看Java如何解决可见性和有序性问题

### volatile

原始意义是禁用CPU缓存。

### Happens-Before 规则

前面一个操作的结果对后续操作是可见的。

1.程序的顺序性规则。

在一个线程中，按照程序顺序，前面的操作Happens-before与后续的任意操作。

2.volatile变量规则

这条规则是指对一个volatile变量的写操作，Happens-Before于后续对这个volatile变量的读操作。

3.传递性。

这条规则是指如果A Happens-Before B，且B Happens-Before C，那么A Happens-Before C。


4.管程中锁的规则

这条规则是指对一个锁的解锁Happens-Before于后续对这个所得枷锁。

管程是一种通用的同步原语，在Java中指的就是synchronized,synchronized是Java里对管程的实现。



5.线程start()规则

这条是关于线程启动的。它是指主线程A启动子线程B后，子线程B能够看到主线程在启动子线程B前的操作。

换句话说就是，如果线程A调用线程B的 start() 方法（即在线程A中启动线程B），那么该start()操作 Happens-Before 于线程B中的任意操作。



6. 线程join()规则

这条是关于线程等待的。它是指主线程A等待子线程B完成（主线程A通过调用子线程B的join()方法实现），当子线程B完成后（主线程A中join()方法返回），主线程能够看到子线程的操作。当然所谓的“看到”，指的是对共享变量的操作。

换句话说就是，如果在线程A中，调用线程B的 join() 并成功返回，那么线程B中的任意操作Happens-Before 于该 join() 操作的返回。

## 被我们忽略的final

final修饰变量时，初衷是告诉编译器：这个变量生而不变，可以可劲儿优化。

发布一个对象的意思是使它能够被当前范围之外的代码所使用。
逸出是指一个对象在尚未准备好时就将它发布。


















